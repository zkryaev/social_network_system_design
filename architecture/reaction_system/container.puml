@startuml Reaction_container
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml
!define DEVICONS https://raw.githubusercontent.com/tupadr3/plantuml-icon-font-sprites/master/devicons

!include DEVICONS/postgresql.puml
!include DEVICONS/redis.puml

Person(client, "Client", "Site/Mobile")
Container(loadBalancer, "Load Balancer", "Nginx", "Uses round robin", $sprite="nginx")
Container(media, "S3 Storage", "Ceph/Minio", "Store images by image_url")
Container(userService, "User Service", "Go", "Store and handle users")
Container(geoService, "Geo Service", "Go", "Store and handle geo marks")
Container(postService, "Post Service", "Go", "Store and handle posts")
ContainerQueue(messageQueue, "Events queue", "Kafka", "Message queue for events by post updates")

Container_Boundary(reactionsServiceGroup, "Reactions Service") {
    Container(reactions, "Reactions Service", "Go", "Store and handle comments and likes", $tags="webApp")
    ContainerDb(reactionsDb, "Reactions database", "PgSQL", "Stores reactions and metainfo", $tags="db", $sprite="postgresql")
    ContainerDb(reactionsCache, "Reactions cache", "Redis", "Stores reactions on popular posts", $tags="db", $sprite="redis")
}

Rel(reactions, reactionsDb, "Read/write reactions")
Rel(reactions, reactionsCache, "Cache reactions on popular posts")

Rel(client, loadBalancer, "Request", "REST")
Rel(loadBalancer, postService, "CRUD post, search", "REST")
Rel(loadBalancer, userService, "CRUD users, subscribes", "REST")
Rel(loadBalancer, reactions, "CRUD likes/comments", "REST")
Rel(loadBalancer, media, "CRUD media", "REST")

Rel(postService, geoService, "Get geo info")
Rel(userService, geoService, "Get geo info")
Rel(postService, messageQueue, "Publishes events for adding/removing a post")
Rel(reactions, messageQueue, "Subscribes on events for adding/removing a post")
Rel(postService, media, "Notify about changes")
@enduml