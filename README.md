# Cоциальная сеть для путешественников - [System Design Course](https://balun.courses/courses/system_design)

## Функциональные требования
  1. Создание поста, с 1 фотографией, описанием и тэгом местоположения;
  2. Оценка и комментирование поста; 
  3. Подписка на других путешественников, для отслеживание их активности;
  4. Поиск популярных мест для путешествий, выдача постов связанных с этим местом (тэгом местоположения);
  5. Просмотр ленты других путешественников, ленты конкретного пользователя, основанной на подписках в обратном хронологическом порядке;

## Нефункциональные требования
  - **Аудитория**:
    1. **DAU**: *10.000.000*
    2. **Активность пользователя *в среднем***:
        - *Публикует 1 пост в день*
        - *Просматривает суммарно 20-100 постов в день из ленты:*
          1. Оценивает 5-50 постов (50%)
          2. Комментирует 3-30 постов (30%)
        - *Подписывается на 1-го нового путешественника в день*
        - *Выполняет поиск мест для путешествий 3-5 раз в день, просматривая 10 постов*
     - Итого:
       - **Nwrite запросов = 82** = 1 + 50 + 30 + 1
       - **Nread запросов = 15** = 10 (пагинация по 10 постов) + 5
       - **Nзапросов = 97**
    3. **Регион:** *СНГ*
  - **Особенности приложения**:
    1. **Сезонности в приложении:** *НЕТ*
    2. **Доступность:** *99.95*
    3. **Условия хранения данных:** *Храним всегда*
    4. **Лимиты и ограничения:**
       1. *Загружать не более 10 постов в день*
       2. *Смотреть, оценивать и комментировать не более 1000 постов в день*
       3. *Оставлять не более 1000 комментариев*
       4. *Максимальное количество подписчиков 1.000.000*
       5. *Максимальное количество подпис**ок** 1.000.000*
    5. **Временные ограничения:**
       1. *Создание поста 1с*
       2. *Получение в ленте 10 постов 1-2с*
       3. *Операция оценки/комментирования/подписки 300-500мс*
       4. *Поиск постов 1-2с*

## Оценка нагрузки

### Расчет RPS
- RPS(общ) = 10.000.000 * 97 / 86400 = 11227
- RPS(write) = 10.000.000 * 82 / 86400 = 9490
- RPS(read) = 10.000.000 * 15 / 86400 = 1736

### Расчет трафика
#### Операции Записи/Чтения
```
== Write ==

operation CreatePost [~400Kb] {
    id
    user_id 
    title ~ 100B
    image ~ 400Kb
    created_at
}

operation Like [40B] {
    id
    user_id
    author_id
    post_id
    created_at
}

operation Comment [120B] {
    id
    user_id
    author_id
    post_id
    title // ~ 80 байт
    created_at
}

operation Subcribe [32B] {
    id
    user_id
    author_id
    created_at
}

== Read ==

operation GetComments [832B] {
    id
    post_id
    comments: [ // Пусть 10 комментариев ~ 800B
        "example", ~ 80B
        ...
    ]
    cursor
    total
}

operation FetchPosts [32+10*162 = 1.6Kb] {
    id
    user_id
    posts: [
        post [162B]: {
            post_id
            author_id
            like_amount
            title ~ 100B
            image_url ~ 30B // -> operation GetImage
            geo_tag_id // (Россия, Байкал = 215151920)
        }
        еще 9...
    ]
    cursor
    total
}

operation GetImage [~400Kb] {
    image_url ~ 30B
    image ~ 400 Kb
}

operation Search [140B] {
    id
    user_id
    title ~ 100B
    geo_tag_id
    cursor
    total
}
```
#### Итоговый трафик

На 1 пользователя:
- Write = 1x(create_post) + 50x(like) + 30x(comment) + 1x(subscribe) = 400Kb + 50*40B + 30*120B + 32B = ~405 Kb/s

- Read = fetch_posts + 10*(get_comments + get_image) + 5x(search) = 1.6Kb + 10*(832B + 400Kb) + 5*140B = ~4 Mb/s
> Получить пост, на каждый пост получаем 10 комментариев и по изображению + 5 поисков

На 10.000.000 пользователей:
- Write = DAU * 405Kb = 4050 Gb/s
- Read = DAU * 4Mb = 40 Tb/s

### Расчет одновременных соединений

- Connections = 10 000 000 \* 0.1 = 1 000 000